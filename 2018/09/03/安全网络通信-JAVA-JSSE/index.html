<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">



  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2" rel="stylesheet">







<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="JAVA,加密通信," />





  <link rel="alternate" href="/atom.xml" title="X-Mallory" type="application/atom+xml" />






<meta name="description" content="JAVA安全套接字扩展（JSSE,Java Secure Socket Extension）基于SSL和TLS协议的Java网络应用程序提供了Java API及参考实现。JSSE支持数据加密、服务器端身份验证、数据完整性，以及可选的客户端身份认证，是信用JSSE,可以保证采用各种应用层协议（Http,telnet和Ftp等）的客户端程序与服务器程序安全的交换数据。JSSE封装了底层复杂的安全通信">
<meta name="keywords" content="JAVA,加密通信">
<meta property="og:type" content="article">
<meta property="og:title" content="安全网络通信(JAVA-JSSE)">
<meta property="og:url" content="http://yoursite.com/2018/09/03/安全网络通信-JAVA-JSSE/index.html">
<meta property="og:site_name" content="X-Mallory">
<meta property="og:description" content="JAVA安全套接字扩展（JSSE,Java Secure Socket Extension）基于SSL和TLS协议的Java网络应用程序提供了Java API及参考实现。JSSE支持数据加密、服务器端身份验证、数据完整性，以及可选的客户端身份认证，是信用JSSE,可以保证采用各种应用层协议（Http,telnet和Ftp等）的客户端程序与服务器程序安全的交换数据。JSSE封装了底层复杂的安全通信">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://yoursite.com/2018/09/03/安全网络通信-JAVA-JSSE/加密通信.png">
<meta property="og:image" content="http://yoursite.com/2018/09/03/安全网络通信-JAVA-JSSE/安全网络通信-JAVA-JSSE/主要类框图.png">
<meta property="og:image" content="http://yoursite.com/2018/09/03/安全网络通信-JAVA-JSSE/安全网络通信-JAVA-JSSE/SSLEngine.png">
<meta property="og:updated_time" content="2018-09-03T16:28:43.200Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="安全网络通信(JAVA-JSSE)">
<meta name="twitter:description" content="JAVA安全套接字扩展（JSSE,Java Secure Socket Extension）基于SSL和TLS协议的Java网络应用程序提供了Java API及参考实现。JSSE支持数据加密、服务器端身份验证、数据完整性，以及可选的客户端身份认证，是信用JSSE,可以保证采用各种应用层协议（Http,telnet和Ftp等）的客户端程序与服务器程序安全的交换数据。JSSE封装了底层复杂的安全通信">
<meta name="twitter:image" content="http://yoursite.com/2018/09/03/安全网络通信-JAVA-JSSE/加密通信.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2018/09/03/安全网络通信-JAVA-JSSE/"/>





  <title>安全网络通信(JAVA-JSSE) | X-Mallory</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">X-Mallory</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">Goals determine what you are going to be</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
            分类
          </a>
        </li>
      

      
    </ul>
  

  
</nav>





  <script>
  (function(i,s,o,g,r,a,m){i["DaoVoiceObject"]=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;a.charset="utf-8";m.parentNode.insertBefore(a,m)})(window,document,"script",('https:' == document.location.protocol ? 'https:' : 'http:') + "//widget.daovoice.io/widget/0f81ff2f.js","daovoice")
  daovoice('init', {
      app_id: "f409b7df"
    });
  daovoice('update');
  </script>
 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/09/03/安全网络通信-JAVA-JSSE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="小小苏">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/640.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="X-Mallory">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">安全网络通信(JAVA-JSSE)</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-09-03T23:49:59+08:00">
                2018-09-03
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/JAVA/" itemprop="url" rel="index">
                    <span itemprop="name">JAVA</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <hr>
<p>JAVA安全套接字扩展（JSSE,Java Secure Socket Extension）基于SSL和TLS协议的Java网络应用程序提供了Java API及参考实现。JSSE支持数据加密、服务器端身份验证、数据完整性，以及可选的客户端身份认证，是信用JSSE,可以保证采用各种应用层协议（Http,telnet和Ftp等）的客户端程序与服务器程序安全的交换数据。<br>JSSE封装了底层复杂的安全通信细节，使得安全开发人员能方便的用它来开发安全的网络应用程序。</p>
<hr>
<a id="more"></a>
<h2 id="1、关于SSL"><a href="#1、关于SSL" class="headerlink" title="1、关于SSL"></a>1、关于SSL</h2><p>SSL(Server Socket Layer)是一种保证网络上连个节点进行安全通信的协议。IETF(Internet Engineering Task Force)对SSL做了标准化，制定了RFC2246规范，并将其成为TLS（Transport Layer Security)。从目前使用的技术上来讲，TLS1.0和SSL3.0之间的差别非常微小。<br>SSL采用加密技术来实现安全通信，保证通信数据的保密性和完整性，并且保证通信双方可以验证对方身份。  </p>
<h3 id="加密通信"><a href="#加密通信" class="headerlink" title="加密通信"></a>加密通信</h3><p><img src="/2018/09/03/安全网络通信-JAVA-JSSE/加密通信.png" alt="加密通信" title="加密通信"></p>
<p>处理对数据进行加密通信外，SSL还采用了身份认证机制，确保通信双方都可以验证对方的真实身份。个人可以通过身份证来来证明自己的身份，SSL通过安全安全证书来证明客户或者服务器的身份。当客户通过安全的连接和扶额u器通信时，服务器会首先向它出示它的安全证书，这个证书声明该服务器是安全的，而且的确是这个服务器。每个证书在全世界的范围内都是唯一的，其他服务器无法假冒原始服务器的身份。<br>安全证书采用公钥加密技术，安全证书机包含了用于加密数据的密钥，又包括了证明身份的数字签名。<br>获得安全证书的方式有两种，一种是从权威机构购买安全证书（安全证书由国际权威的证书机构 CA颁发），另一种是创建自签名的证书（SUN 公司提供的Key tool工具可以创建这样的证书）。</p>
<h3 id="SSL握手"><a href="#SSL握手" class="headerlink" title="SSL握手"></a>SSL握手</h3><p>客户在与服务器通信时，需要完成SSL握手，SSL握手主要完成以下任务：</p>
<ul>
<li>协商使用的加密套件（加密套件包括一组加密参数，这些参数指定了加密的算法和密钥的长度信息等）  </li>
<li>验证对方的身份（此操作可选）</li>
<li>确定使用的加密算法<br>SSL握手的流程如下：<br>（1）客户将自己的SSL版本号、加密参数、与会话有关的数据以及其他必要的信息发送给服务器。<br>（2）服务器将自己的SSL版本号、加密参数、与会话有关的数据以及其他必要的信息发送给客户端，同时还将自己的证书发送给客户，如果需要验证客户的身份，还会发出要求客户端提供证书的请求。<br>（3）客户端验证服务器的证书，如果验证失败，就提示不能建立SS连接，如果成功，则继续下面的步骤。<br>（4）客户端为本次会话生成预备主密钥（pre-master secret）,并用服务器的公钥加密之后发送给服务器。<br>（5）如果服务器要求验证客户端的身份，客户端还要对另外一些数签名后，连同自己的证书一起发送给服务器。<br>（6）如果服务器要求验证客户端的身份，则检查签署客户端证书的CA是否可信，如果在信任列表中，服务器用自己的私钥解密收到的预备主密钥，并用它通过某些算法生成本次会话的主密码（master-secret）。<br>（7）客户端和服务器均使用此主密码生成此次会话的会话密钥（对称密钥）。<br>（8）客户端通知服务器此后的通信都使用这个会话密钥进行加密，并通知服务器客户端已经完成此次SSL握手。<br>（9）服务器通知客户端此后的通信都使用这个会话密钥进行加密，并通知客户端服务器已经完成此次SSL握手。<br>（10）握手结束，会话建立。</li>
</ul>
<h2 id="2、JSSE简介"><a href="#2、JSSE简介" class="headerlink" title="2、JSSE简介"></a>2、JSSE简介</h2><p>JSSE封装了底层复杂的安全通信细节，使得安全开发人员能方便的用它来开发安全的网络应用程序，JDK1.4及以后版本中都自带了JSSE类库。</p>
<h4 id="JSSE主要包含一下四个包："><a href="#JSSE主要包含一下四个包：" class="headerlink" title="JSSE主要包含一下四个包："></a>JSSE主要包含一下四个包：</h4><ul>
<li>javax.net.ssl包：包括进行安全通信的类，比如SSLServerSocket和SSLSocket类。</li>
<li>javax.net包：包括安全套接字的工厂类，比如SSLServerSocketFactory和SSLSocketFactory类。 </li>
<li>java.security.cert包：包括处理安全证书的类，如X509Certificate类。</li>
<li>com.sun.net.ssl包：包括SUN公司提供的JSSE的实现类。<h4 id="JSSE具有以下重要特征："><a href="#JSSE具有以下重要特征：" class="headerlink" title="JSSE具有以下重要特征："></a>JSSE具有以下重要特征：</h4></li>
<li>纯粹用Java语言编写。</li>
<li>可以出口到大多数国家。 </li>
<li>提供了支持SSL2.0和SSL3.0的JSSE API,，并且提供了SSL 3.0 的JSSE实现。</li>
<li>提供了支持TLS1.0的JSSE API和JSSE实现。</li>
<li>提供了用于创建安全连接的类，如SSLSocket、SSLServerSocket和SSLEngine。</li>
<li>支持加密通信。 </li>
<li>支持客户端和服务器端的身份验证。 </li>
<li>支持SSL会话。 </li>
<li>支持一些常用的加密算法，比如RSA（加密长度2048位）、RC4（密钥长度128位）和DH（密钥长度1024位）。</li>
</ul>
<h4 id="JSSE-API的主要类框图"><a href="#JSSE-API的主要类框图" class="headerlink" title="JSSE API的主要类框图"></a>JSSE API的主要类框图</h4><p><img src="/2018/09/03/安全网络通信-JAVA-JSSE/安全网络通信-JAVA-JSSE/主要类框图.png" alt="主要类框图" title="主要类框图"></p>
<p>JSSE中负责安全通信的最核心的类是SSLServerSocket类与SSLSocket类，它们分别是ServerSocket与Socket类的子类。<br>SSLSocket对象由SSLSocketFactory创建，此外，SSLServerSocket的accept()方法也会创建SSLSocket。<br>SSLServerSocket对象由SSLServerSocketFactory创建。<br>SSLSocketFactory、SSLServerSocketFactory以及SSLEngine对象都由SSLContext对象创建。<br>SSLEngine类用于支持非阻塞的安全通信。</p>
<h4 id="创建采用SSL协议的SSLSocket对象"><a href="#创建采用SSL协议的SSLSocket对象" class="headerlink" title="创建采用SSL协议的SSLSocket对象"></a>创建采用SSL协议的SSLSocket对象</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">createSocket</span><span class="params">()</span><span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">    factory=(SSLSocketFactory)SSLSocketFactory.getDefault();</span><br><span class="line">    socket=(SSLSocket)factory.createSocket(host,port);</span><br><span class="line">    String[] supported=socket.getSupportedCipherSuites();</span><br><span class="line">    socket.setEnabledCipherSuites(supported);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<h4 id="KeyStore、KeyManager与TrustManager类"><a href="#KeyStore、KeyManager与TrustManager类" class="headerlink" title="KeyStore、KeyManager与TrustManager类"></a>KeyStore、KeyManager与TrustManager类</h4><p>在进行安全通信时，要求客户端与服务器端都支持SSL或TSL协议。<br>客户端与服务器端可能都需要设置用于证实自身身份的安全证书，还要设置信任对方的安全证书。<br>更常见的情况是，服务器只需要设置用于证实自身身份的安全证书，客户端只需要设置信任服务器的安全证书。<br>KeyStore类用于存放安全证书。以下程序代码创建了一个KeyStore对象，它从test.keys文件中加载安全证书。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">String passphrase = <span class="string">"654321"</span>;</span><br><span class="line"><span class="comment">//JKS是SUN支持的KeyStore的类型</span></span><br><span class="line">KeyStore keyStore = KeyStore.getInstance(<span class="string">"JKS"</span>);  </span><br><span class="line"><span class="keyword">char</span>[] password = passphrase.toCharArray();</span><br><span class="line"><span class="comment">//password参数用于打开安全证书</span></span><br><span class="line">keyStore.load(<span class="keyword">new</span> FileInputStream(<span class="string">"test.keys"</span>), password);</span><br></pre></td></tr></table></figure></p>
<p>KeyManager接口的任务是选择用于证实自身身份的安全证书，把它发送给对方。KeyManagerFactory负责创建KeyManager对象，例如：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">KeyManagerFactory keyManagerFactory = KeyManagerFactory.getInstance(<span class="string">"SunX509"</span>);</span><br><span class="line">keyManagerFactory.init(keyStore, password);</span><br><span class="line">KeyManager[] keyManagers= keyManagerFactory.getKeyManagers();</span><br></pre></td></tr></table></figure></p>
<p>TrustManager接口的任务是决定是否信任对方的安全证书。<br>TruesManagerFactory负责创建TrustManager对象，例如：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">TrustManagerFactory trustManagerFactory = TrustManagerFactory.getInstance(<span class="string">"SunX509"</span>);</span><br><span class="line">trustManagerFactory.init(keyStore);</span><br><span class="line">TrustManager[] trustManagers= trustManagerFactory.getTrustManagers();</span><br></pre></td></tr></table></figure></p>
<h4 id="SSLContext类"><a href="#SSLContext类" class="headerlink" title="SSLContext类"></a>SSLContext类</h4><p>SSLContext类负责设置与安全通信有关的各种信息，比如使用的协议（SSL或者TLS），自身的安全证书以及对方的安全证书。SSLContext还负责构造SSLServerSocketFactory、SSLSocketFactory和SSLEngine对象。<br>以下程序代码创建并初始化了一个SSLContext对象，然后由它创建了一个SSLServerSocketFactory对象：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SSLContext sslCtx = SSLContext.getInstance(<span class="string">"TLS"</span>); <span class="comment">//采用TLS协议</span></span><br><span class="line">sslCtx.init(kmf.getKeyManagers(), tmf.getTrustManagers(), <span class="keyword">null</span>);</span><br><span class="line">SSLServerSocketFactory ssf=sslCtx.getServerSocketFactory();</span><br></pre></td></tr></table></figure></p>
<p>SSLContext的init()方法定义如下:<br>init(KeyManager[] km, TrustManager[] tm, SecureRandom random)<br><em>参数random用于设置安全随机数，如果为null，则采用默认的SecureRandom实现
</em>如果参数km为空，会创建一个默认的KeyMagager对象，以及与之相关联的KeyStore对象，KeyStore对象从系统属性javax.net.ssl.keyStore中获取安全证书，若不存在这个属性，那么KeyStore对象的内容为空.<br>*如果参数tm为空，会创建一个默认的TrustManager对象，以及与之相关联的KeyStore对象，KeyStore对象按照如下步骤获取安全证书：<br>先尝试从系统属性javax.net.ssl.trustStore中获取安全证书<br>若上一步失败，就尝试把&lt;JDK目录&gt;/jre/security/jsscacerts文件作为安全证书文件<br>若上一步失败，就尝试把&lt;JDK目录&gt;/jre/security/cacerts文件作为安全证书文件<br>若上一步失败，则KeyStore对象内容为空</p>
<h4 id="SSLServerSocketFactory类负责创建SSLServerSocket对象："><a href="#SSLServerSocketFactory类负责创建SSLServerSocket对象：" class="headerlink" title="SSLServerSocketFactory类负责创建SSLServerSocket对象："></a>SSLServerSocketFactory类负责创建SSLServerSocket对象：</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SSLServerSocket serverSocket =</span><br><span class="line">(SSLServerSocket) sslServerSocketFactory.createServerSocket(<span class="number">8000</span>);</span><br></pre></td></tr></table></figure>
<p>SSLServerSocketFactory对象有两种创建方法：<br>调用SSLContext类的getServerSocketFactory()方法。<br>调用SSLServerSocketFactory类的静态getDefault()方法。<br>SSLServerSocketFactory类的静态方法getDefault()返回一个默认的SSLServerSocketFactory对象，他与一个默认的SSLcontext对象关联，getDefault()方法的实现按照如下方法初始化这个默认的SSLContext对象：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sslContext.init(<span class="keyword">null</span>,<span class="keyword">null</span>,<span class="keyword">null</span>)</span><br></pre></td></tr></table></figure></p>
<h4 id="SSLSocketFactory类负责创建SSLSocket对象"><a href="#SSLSocketFactory类负责创建SSLSocket对象" class="headerlink" title="SSLSocketFactory类负责创建SSLSocket对象"></a>SSLSocketFactory类负责创建SSLSocket对象</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sslContext.init(<span class="keyword">null</span>,<span class="keyword">null</span>,<span class="keyword">null</span>)</span><br></pre></td></tr></table></figure>
<p>SSLSocketFactory对象有两种创建方法：<br>调用SSLContext类的getSocketFactory()方法。<br>调用SSLSocketFactory类的静态getDefault()方法<br>SSLSocketFactory类的静态方法getDefault()返回一个默认的SSLSocketFactory对象，他与一个n默认的SSLcontext对象关联，getDefault()方法的实现按照如下方法初始化这个默认的SSLContext对象：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sslContext.init(<span class="keyword">null</span>,<span class="keyword">null</span>,<span class="keyword">null</span>)</span><br></pre></td></tr></table></figure></p>
<h4 id="SSLSocket类"><a href="#SSLSocket类" class="headerlink" title="SSLSocket类"></a>SSLSocket类</h4><p>SSLSocket类是Socket类的子类，因此两者的用法有许多相似之处。<br>SSLSocket类还具有与安全通信有关的方法:<br>(1)设置加密套件<br><em>SSLSocket类的getSupportedCipherSuites()方法返回一个字符串数组，它包含当前SSLSocket对象所支持的加密套件组。
</em>SSLSocket类的setEnabledCipherSuites(String[] suites)方法设置当前SSLSocket对象的可使用的加密套件组。<br>可使用的加密套件组应该是所支持的加密套件组的子集。<br>*SSLSocket类的getEnabledCipherSuites()方法返回一个字符串数据，包含当前SSLSocket对象的可使用的加密套件组。<br>例如以下代码仅仅启用了具有高加密强度的加密套件，这可以提高该通信端的安全性，禁止那些不支持强加密的通信端连接当前通信端：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">String[] strongSuites=&#123;<span class="string">"SSL_DES_DSS_WITH_3DES_EDE_CBC_SHA"</span>,</span><br><span class="line"><span class="string">"SSL_RSA_WITH_RC4_128_MD5"</span>,</span><br><span class="line"><span class="string">"SSL_RSA_WITH_RC4_128_SHA"</span>,</span><br><span class="line"><span class="string">"SSL_RSA_WITH_3DES_EDE_CBC_SHA"</span>&#125;;</span><br><span class="line">sslSocket. setEnabledCipherSuites(strongSuites) ;</span><br></pre></td></tr></table></figure></p>
<p>(2)处理握手结束事件<br>SSL握手需要花很长的时间，当SSL握手完成，会发出一个HandshakeCompletedEvent事件，该事件由HandshakeCompletedListener负责监听。<br>SSLSocket类的addHandshakeCompletedListener()方法负责注册HandshakeCompletedListener监听器。<br>HandshakeCompletedEvent类提供了获取与握手事件相关的信息的方法：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> SSLSession <span class="title">getSession</span><span class="params">()</span>  <span class="comment">//获得会话</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getCipherSuite</span><span class="params">()</span>   <span class="comment">//获得实际使用的加密套件</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> SSLSocket <span class="title">getSocket</span><span class="params">()</span>   <span class="comment">//获得发出该事件的套接字</span></span></span><br></pre></td></tr></table></figure></p>
<p>HandshakeCompletedListener接口的以下方法负责处理握手结束事件<br>public void handshakeCompleted(HandshakeCompletedEvent event)<br>(3)管理SSL会话<br>SSLSession接口表示SSL会话，它具有以下方法：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">byte</span>[] getId()  <span class="comment">//获得会话ID。每个会话都有惟一的ID</span></span><br><span class="line"><span class="function">String <span class="title">getCipherSuite</span><span class="params">()</span>  <span class="comment">//获得实际使用的加密套件</span></span></span><br><span class="line"><span class="function"><span class="keyword">long</span> <span class="title">getCreationTime</span><span class="params">()</span>  <span class="comment">//获得创建会话的时间</span></span></span><br><span class="line"><span class="function"><span class="keyword">long</span> <span class="title">getLastAccessedTime</span><span class="params">()</span>  <span class="comment">//获得最近一次访问会话的时间。访问会话是指程序创建一个使用</span></span></span><br><span class="line"><span class="function">该会话的SSLSocket。</span></span><br><span class="line"><span class="function">String <span class="title">getPeerHost</span><span class="params">()</span>  <span class="comment">//获得通信对方的主机</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">getPeerPort</span><span class="params">()</span>  <span class="comment">//获得通信对方的端口</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">invalidate</span><span class="params">()</span>  <span class="comment">//使会话失效</span></span></span><br><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">isValid</span><span class="params">()</span>  <span class="comment">//判断会话是否有效</span></span></span><br></pre></td></tr></table></figure></p>
<p>SSLSocket的getSession()方法返回SSLSocket所属的会话。<br>SSLSocket的setEnableSessionCreation(boolean flag)方法决定SSLSocket是否允许创建新的会话。flag参数的默认值为true。<br>SSLSocket的startHandshake()方法显式的执行一次SSL握手。<br>由于多数情况下客户端无需向服务器证实自己的身份，因此当一个通信端无需向对方证实自己身份，就称它处于客户模式，否则称它处于服务器模式。<br>SSLSocket的setUseClientMode(boolean mode)方法用来设置客户模式或者服务器模式。<br>如果mode参数为true，就表示客户模式，即无需向对方证实自己的身份；<br>如果mode参数为false，就表示服务器模式，即需要向对方证实自己的身份。<br>当SSLSocket处于服务器模式，还可以通过以下方法来决定是否要求对方提供身份认证：<br>setWantClientAuth(boolean want)：当want参数为true，表示希望对方提供身份认证。如果对方未出示安全证书，连接不会中断，通信继续进行。<br>setNeedClientAuth(boolean need)：当need参数为true，表示要求对方必须提供身份认证。如果对方未出示安全证书，连接中断，通信无法继续。</p>
<p>####SSLServerSocket<br>SSLServerSocket类是ServerSocket类的子类，因此两者的用法有许多相似之处。<br>此外，SSLServerSocket类还具有与安全通信有关的方法。这些方法与SSLSocket类中的同名方法具有相同的作用。<br>(1)设置加密套件的方法如下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">String[] getSupportedCipherSuites()：返回一个字符串数组，它包含当前SSLServerSocket对象所支持的加密套件组。</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">setEnabledCipherSuites</span><span class="params">(String[] suites)</span>：设置当前SSLServerSocket对象可使用的加密套件组。</span></span><br><span class="line"><span class="function">String[] <span class="title">getEnabledCipherSuites</span><span class="params">()</span>：返回一个字符串数组，它包含当前SSLServerSocket对象可使用的加密套件组。</span></span><br></pre></td></tr></table></figure></p>
<p>(2)管理SSL会话的方法如下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">setEnableSessionCreation</span><span class="params">(<span class="keyword">boolean</span> flag)</span>：决定由当前SSLServerSocket对象创建的SSLSocket对象是否允许创建新的会话。</span></span><br><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">getEnableSessionCreation</span><span class="params">()</span>：判断由当前SSLServerSocket对象创建的SSLSocket对象是否允许创建新的会话。</span></span><br></pre></td></tr></table></figure></p>
<p>(3)设置客户端模式的方法如下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">setUseClientMode</span><span class="params">(<span class="keyword">boolean</span> mode)</span>：当mode参数为<span class="keyword">true</span>，表示客户端模式。</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">setWantClientAuth</span><span class="params">(<span class="keyword">boolean</span> want)</span>：当want参数为<span class="keyword">true</span>，表示希望对方提供身份认证。</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">setNeedClientAuth</span><span class="params">(<span class="keyword">boolean</span> need)</span>：当need参数为<span class="keyword">true</span>，表示要求对方必须提供身份认证。</span></span><br></pre></td></tr></table></figure></p>
<h4 id="SSLEngine类"><a href="#SSLEngine类" class="headerlink" title="SSLEngine类"></a>SSLEngine类</h4><p>SSLEngine类与SocketChannel类联合使用，就能实现非阻塞的安全通信。<br>SSLEngine类封装了与安全通信有关的细节，把应用程序发送的应用数据打包为网络数据，打包就是指对应用数据进行加密，加入SSL握手数据，把它变为网络数据。<br>SSLEngine类还能把接收到的网络数据展开为应用数据，展开就是指对网络数据解密。<br>SSLEngine类的wrap()方法负责打包应用数据，unwrap()方法负责展开网络数据。<br><img src="/2018/09/03/安全网络通信-JAVA-JSSE/安全网络通信-JAVA-JSSE/SSLEngine.png" alt="SSLEngine" title="SSLEngine"></p>
<h2 id="创建基于SSL的安全服务器和安全客户"><a href="#创建基于SSL的安全服务器和安全客户" class="headerlink" title="创建基于SSL的安全服务器和安全客户"></a>创建基于SSL的安全服务器和安全客户</h2><p>比如：<br>创建一个基于SSL的安全服务器<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.BufferedReader;</span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStreamReader;</span><br><span class="line"><span class="keyword">import</span> java.io.OutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.PrintWriter;</span><br><span class="line"><span class="keyword">import</span> java.net.Socket;</span><br><span class="line"><span class="keyword">import</span> java.security.KeyStore;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.net.ssl.KeyManagerFactory;</span><br><span class="line"><span class="keyword">import</span> javax.net.ssl.SSLContext;</span><br><span class="line"><span class="keyword">import</span> javax.net.ssl.SSLServerSocket;</span><br><span class="line"><span class="keyword">import</span> javax.net.ssl.SSLServerSocketFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EchoServer</span> </span>&#123;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> port =<span class="number">8000</span>;</span><br><span class="line"><span class="keyword">private</span> SSLServerSocket serverSocket;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">EchoServer</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">	SSLContext context=creatSSLContext();</span><br><span class="line">	SSLServerSocketFactory factory=context.getServerSocketFactory();</span><br><span class="line">	serverSocket=(SSLServerSocket) factory.createServerSocket(port);</span><br><span class="line">	System.out.println(<span class="string">"服务器启动！"</span>);</span><br><span class="line">	</span><br><span class="line">	String []supported=serverSocket.getSupportedCipherSuites();</span><br><span class="line">	serverSocket.setEnabledCipherSuites(supported);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> SSLContext <span class="title">creatSSLContext</span><span class="params">()</span><span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">    String keyStoreFile=<span class="string">"test.keystore"</span>;</span><br><span class="line">    String password=<span class="string">"123456"</span>;</span><br><span class="line">    KeyStore ks=KeyStore.getInstance(<span class="string">"JKS"</span>);</span><br><span class="line">    <span class="keyword">char</span>[]psw=password.toCharArray();</span><br><span class="line">    ks.load(<span class="keyword">new</span> FileInputStream(keyStoreFile),psw);</span><br><span class="line">    KeyManagerFactory kmf=KeyManagerFactory.getInstance(<span class="string">"SunX509"</span>);</span><br><span class="line">    kmf.init(ks,psw);</span><br><span class="line">    </span><br><span class="line">    SSLContext sslContext=SSLContext.getInstance(<span class="string">"SSL"</span>);</span><br><span class="line">    sslContext.init(kmf.getKeyManagers(), <span class="keyword">null</span>, <span class="keyword">null</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> sslContext;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">echo</span><span class="params">(String msg)</span></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="string">"echo:"</span>+msg;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> PrintWriter <span class="title">getWriter</span><span class="params">(Socket socket)</span><span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">	</span><br><span class="line">	OutputStream socketOutputStream=socket.getOutputStream();</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">new</span> PrintWriter(socketOutputStream,<span class="keyword">true</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> BufferedReader <span class="title">getReader</span><span class="params">(Socket socket)</span> <span class="keyword">throws</span> IOException</span>&#123;</span><br><span class="line">	InputStream socketIn=socket.getInputStream();</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(socketIn));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">while</span>(<span class="keyword">true</span>)&#123;</span><br><span class="line">		Socket socket=<span class="keyword">null</span>;</span><br><span class="line">		<span class="keyword">try</span>&#123;</span><br><span class="line">			socket=serverSocket.accept();</span><br><span class="line">			System.out.println(<span class="string">"新连接："</span>+socket.getInetAddress()+<span class="string">":"</span>+socket.getPort());</span><br><span class="line">			</span><br><span class="line">			BufferedReader br=getReader(socket);</span><br><span class="line">			PrintWriter pw=getWriter(socket);</span><br><span class="line">			</span><br><span class="line">			String msg=<span class="keyword">null</span>;</span><br><span class="line">			<span class="keyword">while</span> ((msg=br.readLine())!=<span class="keyword">null</span>) &#123;</span><br><span class="line">				System.out.println(msg);</span><br><span class="line">				pw.println(echo(msg));</span><br><span class="line">				<span class="keyword">if</span>(msg.equals(<span class="string">"bye"</span>))&#123;</span><br><span class="line">					<span class="keyword">break</span>;</span><br><span class="line">				&#125;</span><br><span class="line">					</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;<span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">			<span class="keyword">if</span>(socket!=<span class="keyword">null</span>)</span><br><span class="line">				<span class="keyword">try</span> &#123;</span><br><span class="line">					socket.close();</span><br><span class="line">				&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">					e.printStackTrace();</span><br><span class="line">				&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span><span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">	<span class="keyword">new</span> EchoServer().service();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>对应的，创建一个基于SSL的安全客户<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.BufferedReader;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStreamReader;</span><br><span class="line"><span class="keyword">import</span> java.io.OutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.PrintWriter;</span><br><span class="line"><span class="keyword">import</span> java.net.Socket;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.net.ssl.SSLSocket;</span><br><span class="line"><span class="keyword">import</span> javax.net.ssl.SSLSocketFactory;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EchoClient</span> </span>&#123;</span><br><span class="line"><span class="keyword">private</span> String host=<span class="string">"localhost"</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> port=<span class="number">8000</span>;</span><br><span class="line"><span class="keyword">private</span> SSLSocket socket;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">EchoClient</span><span class="params">()</span><span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">	SSLSocketFactory factory=(SSLSocketFactory) SSLSocketFactory.getDefault();</span><br><span class="line">	socket=(SSLSocket) factory.createSocket(host,port);</span><br><span class="line">	</span><br><span class="line">	String[] supported=socket.getSupportedCipherSuites();</span><br><span class="line">	socket.setEnabledCipherSuites(supported);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">	<span class="keyword">new</span> EchoClient().talk();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> PrintWriter <span class="title">getWriter</span><span class="params">(Socket socket)</span><span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">	</span><br><span class="line">	OutputStream socketOutputStream=socket.getOutputStream();</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">new</span> PrintWriter(socketOutputStream,<span class="keyword">true</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> BufferedReader <span class="title">getReader</span><span class="params">(Socket socket)</span> <span class="keyword">throws</span> IOException</span>&#123;</span><br><span class="line">	InputStream socketIn=socket.getInputStream();</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(socketIn));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">talk</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">try</span>&#123;</span><br><span class="line">		BufferedReader bReader=getReader(socket);</span><br><span class="line">		PrintWriter pWriter=getWriter(socket);</span><br><span class="line">		BufferedReader localReader=<span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(System.in));</span><br><span class="line">		String msg=<span class="keyword">null</span>;</span><br><span class="line">		 <span class="keyword">while</span>((msg=localReader.readLine())!=<span class="keyword">null</span>)&#123;</span><br><span class="line">			 </span><br><span class="line">			 pWriter.println(msg);</span><br><span class="line">			 System.out.println(bReader.readLine());</span><br><span class="line">			 </span><br><span class="line">			 <span class="keyword">if</span>(msg.equals(<span class="string">"bye"</span>))&#123;</span><br><span class="line">				 <span class="keyword">break</span>;</span><br><span class="line">			 &#125;</span><br><span class="line">		 &#125;</span><br><span class="line">			 </span><br><span class="line">	&#125;<span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">		e.printStackTrace();</span><br><span class="line">	&#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			socket.close();</span><br><span class="line">		&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">			<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><blockquote>
<ul>
<li>JAVA安全套接字扩展（JSSE,Java Secure Socket Extension）基于SSL和TLS协议的Java网络应用程序提供了Java API及参考实现。JSSE支持数据加密、服务器端身份验证、数据完整性，以及可选的客户端身份认证，是信用JSSE,可以保证采用各种应用层协议（Http,telnet和Ftp等）的客户端程序与服务器程序安全的交换数据。   </li>
<li>JSSE封装了底层复杂的安全通信细节，使得安全开发人员能方便的用它来开发安全的网络应用程序。</li>
<li>JSSE中负责安全通信的最核心的类是SSLServerSocket类与SSLSocket类，它们分别是ServerSocket与Socket类的子类。</li>
<li>SSLSocket对象由SSLSocketFactory创建，此外，SSLServerSocket的accept()方法也会创建SSLSocket。</li>
<li>SSLServerSocket对象由SSLServerSocketFactory创建。</li>
<li>SSLSocketFactory、SSLServerSocketFactory以及SSLEngine对象都由SSLContext对象创建。</li>
<li>SSLEngine类用于支持非阻塞的安全通信。</li>
<li>SSLContext负责为SSLSocket和SSLSocketFactory设置安全参数，如使用的安全协议、安全证书、KeyManager、TrustManager和安全随机数等。</li>
</ul>
</blockquote>
<p>Mallory<br>2018年9月3日</p>
<hr>
<p>资料参考：<br>［1］孙卫琴 JAVA网络编程精解</p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/JAVA/" rel="tag"># JAVA</a>
          
            <a href="/tags/加密通信/" rel="tag"># 加密通信</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/06/03/从比特币开始学习区块链/" rel="next" title="从比特币开始学习区块链">
                <i class="fa fa-chevron-left"></i> 从比特币开始学习区块链
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/640.jpg"
                alt="小小苏" />
            
              <p class="site-author-name" itemprop="name">小小苏</p>
              <p class="site-description motion-element" itemprop="description">斯人若彩虹，遇上方知有</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives">
              
                  <span class="site-state-item-count">5</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">3</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">8</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/X-Mallory" target="_blank" title="GitHub">
                      GitHub</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">小小苏</span>

  
</div>


 <!-- <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a> v5.1.4</div>
-->




<div class="powered-by">
<i class="fa fa-user-md"></i><span id="busuanzi_container_site_uv">
  本站访客数:<span id="busuanzi_value_site_uv"></span>
</span>
</div>
        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
<!-- ҳ����С���� -->
<script type="text/javascript" src="/js/src/love.js"></script>